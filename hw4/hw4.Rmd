---
title: "DATA 622 HW4 - Clustering, PCA and SVM"
author: "Mael Illien, Dhairav Chhatbar, Santosh Manjrekar"
date: "4/12/2021"
output: 
  html_document:
    code_folding: show
    theme: cosmo
    highlight: tango
    toc: true
    number_section: false
    toc_float:
      collapsed: true
      smooth_scroll: true
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setup

```{r message=FALSE, warning=FALSE}
library(skimr)
library(tidyverse)
library(caret) # For featureplot, classification report
library(corrplot) # For correlation matrix
library(AppliedPredictiveModeling)
library(mice) # For data imputation
library(VIM) # For missing data visualization
library(gridExtra) # For grid plots
library(pROC) # For AUC calculations
library(ROCR) # For ROC and AUC plots
library(dendextend)
```


# ADHD Dataset

```{r}
adhd_raw <- read.csv('https://raw.githubusercontent.com/maelillien/data622/main/hw4/adhd_data.csv', header = TRUE)
adhd <- adhd_raw
```

```{r}
head(adhd)
```

```{r}
adhd[adhd==''] <- NA 
skim(adhd)
```


## Data Pre-processing

Variables need to be numeric, computations based on distance.

```{r}
# Selecting only variables not containing Qs
adhd <- adhd %>% select(c(Age, Sex, Race, ADHD.Total, MD.TOTAL, Alcohol:Psych.meds.))
# Renaming variables
adhd <- rename(adhd, ADHDTotal = ADHD.Total, MDTotal = MD.TOTAL, Sedatives = Sedative.hypnotics, CourtOrder = Court.order, 
               Violence = Hx.of.Violence, Conduct = Disorderly.Conduct, NonSubstDX = Non.subst.Dx, SubstDX = Subst.Dx, PsychMeds = Psych.meds.)

# shift sex variable to 0 and 1
adhd$Sex <- adhd$Sex-1


```

```{r}
#adhd <- data.frame(lapply(adhd,as.numeric))
adhd <- mutate_all(adhd, function(x) as.numeric(as.character(x)))
```






#### Imputation of Missing Values

```{r}
mice_plot <- aggr(adhd, col=c('#F8766D','#00BFC4'), numbers=TRUE, sortVars=TRUE, labels=names(adhd), cex.axis=.7, gap=3, ylab=c("Missing data","Pattern"))
```

```{r}
dim(adhd)
```


```{r}
# Discard PsychMeds
adhd.complete <- adhd %>% select(-c(PsychMeds))

# Keep only complete cases
adhd.complete <- adhd.complete[complete.cases(adhd.complete),]
```

```{r}
dim(adhd.complete)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
# pmm for numerical variables, logreg for binary factor variables and polyr for ordered factor variables
# init <- mice(adhd, maxit=0)
# meth <- init$method
# predM <- init$predictorMatrix
# meth[c('CourtOrder','Violence','Conduct','Suicide')] <- 'logreg'
# meth[c('Alcohol','THC','Cocaine','Stimulants','Sedatives','Opioids','Abuse', 'NonSubstDX','SubstDX','PsychMeds')] <- 'polr'
# meth[c('Age','Sex','Race','ADHDTotal','MDTotal')] = ''
# imputed <- mice(adhd, method=meth, predictorMatrix=predM, maxit=50, m=5, seed=500)
# adhd_imp <- complete(imputed)

#'NonSubstDX','SubstDX','PsychMeds' are discrete numerical variables and should be imputed using other techniques: mean, median or mode

```

## Data Exploration



## Data Processing

```{r}
# Re-coding Education Variable, College = Education > 12, HS = Education > 8 & <= 12, MS = Education <= 8 
adhd.complete$Education <- ifelse(adhd.complete$Education <= 8, 1, ifelse(adhd.complete$Education <= 12 & adhd.complete$Education > 8, 2, ifelse(adhd.complete$Education > 12, 3, 99)))
# Creating new variables based on type of abuse
adhd.complete$Abuse <- as.numeric(adhd.complete$Abuse != 0)
adhd.complete$AbuseP <- as.numeric(adhd.complete$Abuse == 1)
adhd.complete$AbuseS <- as.numeric(adhd.complete$Abuse == 2)
adhd.complete$AbuseE <- as.numeric(adhd.complete$Abuse == 3)
adhd.complete$AbusePS <- as.numeric(adhd.complete$Abuse == 4)
adhd.complete$AbusePE <- as.numeric(adhd.complete$Abuse == 5)
adhd.complete$AbuseES <- as.numeric(adhd.complete$Abuse == 6)
adhd.complete$AbusePES <- as.numeric(adhd.complete$Abuse == 7)
```

```{r}
head(adhd.complete)
```


Data must be scaled

```{r}
adhd.scaled <- scale(adhd.complete)
```


# Clustering

```{r}
# Dissimilarity matrix
d <- dist(adhd.scaled, method = "euclidean")

# Hierarchical clustering using Complete Linkage
hc1 <- hclust(d, method = "complete" )
```


```{r, fig.width = 12}
# Plot the obtained dendrogram
plot(hc1, cex = 0.3, hang = -1)
abline(h = 10, lty = 2)
```

```{r, fig.width = 12}
# Convert hclust into a dendrogram and plot
hcd <- as.dendrogram(hc1)
plot(hcd, type = "triangle", ylab = "Height", cex = 0.3)
abline(h = 9, lty = 2)
```

```{r, fig.width = 12}
dend <- adhd.complete %>%  scale %>% 
        dist %>% hclust %>% as.dendrogram
dend %>% set("branches_k_color", k = 6) %>% plot(main = "HC")
```


# PCA

# SVM



